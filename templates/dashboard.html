{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h2>üèÜ Ranking Semanal (Semana {{ current_week }})</h2>
        
        <!-- FORMUL√ÅRIO PARA ADICIONAR PROBLEMAS - ATUALIZADO -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">üìä Adicionar Problemas de Hoje</h5>
                <form method="POST" action="{{ url_for('add_problems') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Quantos problemas resolveu AGORA?</label>
                            <input type="number" class="form-control" name="problems_solved" 
                                   min="1" max="20" value="1" required>
                            <small class="text-muted">N√∫mero de problemas resolvidos desde a √∫ltima atualiza√ß√£o</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-success w-100">
                                ‚ûï Adicionar Problemas
                            </button>
                        </div>
                    </div>
                    <small class="text-muted">
                        üí° Digite quantos problemas voc√™ resolveu desde a √∫ltima vez que atualizou
                    </small>
                </form>
            </div>
        </div>

        <!-- RANKING -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Posi√ß√£o</th>
                        <th>Usu√°rio</th>
                        <th>Problemas Resolvidos</th>
                        <th>BeeCrowd ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_data in ranking %}
                    <tr class="{% if user_data.username == session.username %}table-primary{% endif %}">
                        <td>
                            {% if loop.index == 1 %}ü•á
                            {% elif loop.index == 2 %}ü•à
                            {% elif loop.index == 3 %}ü•â
                            {% else %}{{ loop.index }}
                            {% endif %}
                        </td>
                        <td>
                            {{ user_data.username }}
                            {% if user_data.username == session.username %}<strong>(Voc√™)</strong>{% endif %}
                        </td>
                        <td>
                            <span class="badge bg-success">{{ user_data.problems_solved }}</span>
                        </td>
                        <td>
                            <small class="text-muted">{{ user_data.beecrowd_id }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">üë• Adicionar Amigo</h5>
                <form method="POST" action="{{ url_for('add_friend') }}">
                    <div class="mb-3">
                        <label class="form-label">BeeCrowd ID do amigo</label>
                        <input type="number" class="form-control" name="friend_id" required>
                        <small class="text-muted">N√∫mero do perfil do amigo (ex: 12345)</small>
                    </div>
                    <button type="submit" class="btn btn-success w-100">‚ûï Adicionar Amigo</button>
                </form>
            </div>
        </div>
        <!-- No dashboard.html, depois do card de amigo -->
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title">üìà An√°lise de Progresso</h5>
                <p>Acompanhe sua evolu√ß√£o semana a semana</p>
                <a href="{{ url_for('progresso') }}" class="btn btn-warning w-100">
                    üìä Ver Gr√°ficos de Progresso
                </a>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title">üìà Seu Progresso</h5>
                <p><strong>üêù Seu BeeCrowd ID:</strong> {{ user.beecrowd_id }}</p>
                <p><strong>üèÖ Sua Posi√ß√£o:</strong> 
                    {% for user_data in ranking %}
                        {% if user_data.username == session.username %}
                            <span class="badge bg-primary">{{ loop.index }}¬∫ Lugar</span>
                        {% endif %}
                    {% endfor %}
                </p>
                <p><strong>‚úÖ Problemas da Semana:</strong> 
                    {% for user_data in ranking %}
                        {% if user_data.username == session.username %}
                            <span class="badge bg-success">{{ user_data.problems_solved }} resolvidos</span>
                        {% endif %}
                    {% endfor %}
                </p>
                
                <!-- BOT√ÉO DE SINCRONIZA√á√ÉO -->
                <div class="mt-3">
                    <a href="{{ url_for('sync_beecrowd') }}" class="btn btn-info btn-sm w-100">
                        üîÑ Sincronizar com BeeCrowd
                    </a>
                    <small class="text-muted">
                        Pega automaticamente seu total de problemas
                    </small>
                </div>

                <!-- INFO DO SISTEMA -->
                <div class="mt-3 p-2 bg-light rounded">
                    <small class="text-muted">
                        <strong>üí° Como funciona:</strong><br>
                        ‚Ä¢ <strong>Adicionar Problemas</strong>: Some ao seu total de hoje<br>
                        ‚Ä¢ <strong>Sincronizar</strong>: Pega seu total do BeeCrowd<br>
                        ‚Ä¢ Ranking: Soma todos os dias da semana
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}